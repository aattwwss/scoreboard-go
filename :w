<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SSE Example</title>
</head>

<body>
	<h1>Server-Sent Events Example</h1>
	<div id="display">00:00</div>
	<div id="events"></div>

	<script>
		const eventsContainer = document.getElementById('events');

		function addEvent(text) {
			const p = document.createElement('p');
			p.textContent = text;
			eventsContainer.appendChild(p);
			window.scrollTo(0, document.body.scrollHeight);
		}
		const eventSource = new EventSource('http://192.168.1.186:8080/events');
		eventSource.onopen = function () {
			addEvent('Connection opened');
		};
		eventSource.onmessage = handleDefault;
		eventSource.addEventListener('start', handleStart)
		eventSource.addEventListener('stop', handleStop)
		eventSource.addEventListener('reset', handleReset)

		function handleMetric(event) {
			addEvent(`Metric ${event.type}: ${event.data}`);
		}

		function handleClose(event) {
			addEvent('Server closed!');
			eventSource.close();
		}

		function handleStart(event) {
			addEvent(`${event.data}`);
			console.log(`start: ${event.data}`);
		}

		function handleStop(event) {
			addEvent(`${event.data}`);
			console.log(`stop: ${event.data}`);
		}

		function handleReset(event) {
			addEvent(`${event.data}`);
			console.log(`reset: ${event.data}`);
		}

		function handleDefault(event) {
			addEvent(`message: ${event.data}`);
			console.log(`message: ${event.data}`);
		}
		eventSource.onerror = function (error) {
			addEvent('Error: ' + error.type);
			eventSource.close();
		};
	</script>
</body>

</html>
